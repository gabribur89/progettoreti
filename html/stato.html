<html lang="en">
<head>
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<body>
<h1>Stato Abbonamenti</h1>
<table class="table">
  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Nome</th>
      <th scope="col">Cognome</th>
      <th scope="col">Data di Iscrizione</th>
	  <th scope="col">Stato</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row" id="idop"></th>
      <td id="nome"></td>
      <td id="cognome"></td>
      <td id="dataiscrizione"></td>
      <td id="stato"></td>
    </tr>
  </tbody>
</table>
<br>
<!--<div id="operazione"></div>
<div id="nome"></div>
<div id="cognome"></div>-->
<h1>Stato Richieste</h1>
<!--<div id="richiesta"></div>
<div id="risultato"></div>-->
<table class="table">
  <thead>
    <tr>
      <th scope="col">ID Richiesta</th>
      <th scope="col">Risultato</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="richiesta"></td>
      <td id="risultato"></td>
    </tr>
  </tbody>
</table>
<br>


<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io('http://localhost:3000');
  socket.on('vista', function (data) {
    console.log("Arrivato dato: ", data);

    // opzionale se voglio fare altro in base al tipo di operazione 
    if(data.type == "INSERT"){
      //$("#operazione").append("Inserimento avvenuto con successo");
	  $("#stato").append('<p>INSERITO <button type="submit" class="btn btn-danger" id="'+data.id+'">Elimina</button></p>');
    }
    if(data.type == "UPDATE"){
     //$("#operazione").append("Aggiornamento avvenuto con successo");
    }
    if(data.type == "DELETE"){
     //$("#operazione").append("Eliminazione avvenuta con successo");
	 
    }
	
	$(".btn").click(function(){
		//console.log("aaa");
		var id = $(this).attr('id');
		//console.log(id);
		
		$.ajax({
			url: '/cancella/'+id+'/',
			type: 'PUT',
			success: function(response){
				console.log(response);
			}
		});
			
	});
	
	$("#idop").append("<p>"+data.id+"</p>");
    $("#nome").append('<p>'+data.nome+'<p>');
    $("#cognome").append('<p>'+data.cognome+'<p>');
	$("#dataiscrizione").append('<p>'+data.dataiscrizione+'<p>');
	
    //$("#operazione").append('<p>OPERAZIONE: '+data.type+'<p>');

});

socket.on('richieste', function (data) {
  console.log("richiesta processata", data);
  /*if (data.hasOwnProperty('op') && data.op == 'DELETE')
  {
	console.log("elimino la linea di id", data.id);
  }*/
  //console.log("data",data.dataiscrizione);
  $("#richiesta").html("<p>"+data.requestid+"</p>");
  $("#risultato").html("<p>"+data.result+"</p>");

});

</script>
</body>
</html>
